<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Serialization streams</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="madalgo-doxygen.css" rel="stylesheet" type="text/css"/>
<link href="printstyle.css" rel="stylesheet" type="text/css" media="print" />
</head>
<body>
<div id="top">
<div id="titlearea">
<h1 id="projectname">TPIE</h1>
<span class="version"><a href="//github.com/thomasmoelhave/tpie/tree/4739728">4739728</a></span>
</div>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('serialization.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Serialization streams </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_serintro"></a>
Motivation</h1>
<p>If you want to read and write text strings with TPIE <code>file_streams</code>, the interface requires a fixed string size. In some cases this may be unreasonable: space is wasted on strings that are smaller than the given size limit, and it may be impossible to give a fixed upper bound on the length of the strings a program has to operate on.</p>
<p>For this, TPIE provides a serialization framework with a distinct set of stream readers and writers that support, in essence, variable-length item types, such as strings and arrays. With the library support for reversing and sorting such serialization streams, it becomes reasonably easy to implement external memory algorithms operating on variable length items.</p>
<p>The goal of TPIE serialization is <em>not</em> to be portable across machines, nor is it to provide type-checking on the serialized input. We do not track endianness or integer widths, so it is not in general supported to read serialized streams written on a different platform. Indeed, the motivation for TPIE serialization is to support temporary streams of variable-width items in external memory; it is not intended as a persistent store or as a data transfer format.</p>
<p>TPIE serialization has built-in support for plain old data, also known as POD types. This built-in POD support excludes pointer types, however. POD types are serialized and unserialized by their in-memory representation. This is intended to be fast, not safe or portable.</p>
<p>The framework also supports certain library types out of the box, such as <code>std::vector</code>, <code>std::string</code> and plain old arrays of serializable data.</p>
<h1><a class="anchor" id="sec_serusage"></a>
Usage</h1>
<p>The interface and usage is straightforward. See the included test program <code>lines</code>, the bulk of which is reproduced below.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> write_lines(std::istream &amp; is, std::string filename) {</div>
<div class="line">    std::string line;</div>
<div class="line">    <a class="code" href="classtpie_1_1serialization__writer.html">tpie::serialization_writer</a> wr;</div>
<div class="line">    wr.open(filename);</div>
<div class="line">    <span class="keywordflow">while</span> (std::getline(is, line)) {</div>
<div class="line">        wr.<a class="code" href="classtpie_1_1serialization__writer.html#a5d75d252db09d6ab5495e823441456ab">serialize</a>(line);</div>
<div class="line">    }</div>
<div class="line">    wr.close();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> reverse_lines(std::string filename) {</div>
<div class="line">    <a class="code" href="classtpie_1_1temp__file.html">tpie::temp_file</a> f;</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classtpie_1_1serialization__reader.html">tpie::serialization_reader</a> rd;</div>
<div class="line">        rd.open(filename);</div>
<div class="line">        <a class="code" href="classtpie_1_1serialization__reverse__writer.html">tpie::serialization_reverse_writer</a> wr;</div>
<div class="line">        wr.open(f);</div>
<div class="line">        <span class="keywordflow">while</span> (rd.can_read()) {</div>
<div class="line">            std::string line;</div>
<div class="line">            rd.<a class="code" href="classtpie_1_1bits_1_1serialization__reader__base.html#ac2dfee4e06718e689676a2aec212e805">unserialize</a>(line);</div>
<div class="line">            wr.<a class="code" href="classtpie_1_1serialization__reverse__writer.html#ad113f5a6fc42c2e3246b15c3b4af88a9">serialize</a>(line);</div>
<div class="line">        }</div>
<div class="line">        wr.close();</div>
<div class="line">        rd.close();</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classtpie_1_1serialization__reverse__reader.html">tpie::serialization_reverse_reader</a> rd;</div>
<div class="line">        rd.open(f);</div>
<div class="line">        <a class="code" href="classtpie_1_1serialization__writer.html">tpie::serialization_writer</a> wr;</div>
<div class="line">        wr.open(filename);</div>
<div class="line">        <span class="keywordflow">while</span> (rd.can_read()) {</div>
<div class="line">            std::string line;</div>
<div class="line">            rd.<a class="code" href="classtpie_1_1bits_1_1serialization__reader__base.html#ac2dfee4e06718e689676a2aec212e805">unserialize</a>(line);</div>
<div class="line">            wr.<a class="code" href="classtpie_1_1serialization__writer.html#a5d75d252db09d6ab5495e823441456ab">serialize</a>(line);</div>
<div class="line">        }</div>
<div class="line">        wr.close();</div>
<div class="line">        rd.close();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> read_lines(std::ostream &amp; os, std::string filename) {</div>
<div class="line">    <a class="code" href="classtpie_1_1serialization__reader.html">tpie::serialization_reader</a> rd;</div>
<div class="line">    rd.open(filename);</div>
<div class="line">    <span class="keywordflow">while</span> (rd.can_read()) {</div>
<div class="line">        std::string line;</div>
<div class="line">        rd.<a class="code" href="classtpie_1_1bits_1_1serialization__reader__base.html#ac2dfee4e06718e689676a2aec212e805">unserialize</a>(line);</div>
<div class="line">        os &lt;&lt; line &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">    }</div>
<div class="line">    rd.close();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> sort_lines(std::string filename) {</div>
<div class="line">    <a class="code" href="classtpie_1_1serialization__sorter.html">tpie::serialization_sorter&lt;std::string&gt;</a> sorter;</div>
<div class="line">    sorter.set_available_memory(50*1024*1024);</div>
<div class="line">    sorter.begin();</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classtpie_1_1serialization__reader.html">tpie::serialization_reader</a> rd;</div>
<div class="line">        rd.open(filename);</div>
<div class="line">        <span class="keywordflow">while</span> (rd.can_read()) {</div>
<div class="line">            std::string line;</div>
<div class="line">            rd.<a class="code" href="classtpie_1_1bits_1_1serialization__reader__base.html#ac2dfee4e06718e689676a2aec212e805">unserialize</a>(line);</div>
<div class="line">            sorter.push(line);</div>
<div class="line">        }</div>
<div class="line">        rd.close();</div>
<div class="line">    }</div>
<div class="line">    sorter.end();</div>
<div class="line">    sorter.merge_runs();</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classtpie_1_1serialization__writer.html">tpie::serialization_writer</a> wr;</div>
<div class="line">        wr.open(filename);</div>
<div class="line">        <span class="keywordflow">while</span> (sorter.can_pull()) {</div>
<div class="line">            wr.<a class="code" href="classtpie_1_1serialization__writer.html#a5d75d252db09d6ab5495e823441456ab">serialize</a>(sorter.pull());</div>
<div class="line">        }</div>
<div class="line">        wr.close();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_ser_user"></a>
User-supplied serializable types</h1>
<p>For types other than those supported natively by TPIE serialization, the user can provide implementations of the <code>serialize</code> and <code>unserialize</code> procedures. For example, we can implement simple serialization/unserialization of a point type:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>userland {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>point2 {</div>
<div class="line">    <span class="keywordtype">double</span> x;</div>
<div class="line">    <span class="keywordtype">double</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Dst&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">serialize</a>(Dst &amp; d, <span class="keyword">const</span> point2 &amp; pt) {</div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">tpie::serialize</a>;</div>
<div class="line">    <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">serialize</a>(d, pt.x);</div>
<div class="line">    <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">serialize</a>(d, pt.y);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Src&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">unserialize</a>(Src &amp; s, point2 &amp; pt) {</div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">tpie::unserialize</a>;</div>
<div class="line">    <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">unserialize</a>(s, pt.x);</div>
<div class="line">    <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">unserialize</a>(s, pt.y);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace userland</span></div>
</div><!-- fragment --><p>For a more complicated example, consider how we might serialize and unserialize a <code>std::vector</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> D, <span class="keyword">typename</span> T, <span class="keyword">typename</span> alloc_t&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">serialize</a>(D &amp; dst, <span class="keyword">const</span> std::vector&lt;T, alloc_t&gt; &amp; v) {</div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">tpie::serialize</a>;</div>
<div class="line">    <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">serialize</a>(dst, v.size());</div>
<div class="line">    <a class="code" href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">serialize</a>(dst, v.begin(), v.end());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> S, <span class="keyword">typename</span> T, <span class="keyword">typename</span> alloc_t&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">unserialize</a>(S &amp; src, std::vector&lt;T, alloc_t&gt; &amp; v) {</div>
<div class="line">    <span class="keyword">typename</span> std::vector&lt;T&gt;::size_type s;</div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">tpie::unserialize</a>;</div>
<div class="line">    <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">unserialize</a>(src, s);</div>
<div class="line">    v.resize(s);</div>
<div class="line">    <a class="code" href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">unserialize</a>(src, v.begin(), v.end());</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclasstpie_1_1serialization__sorter_html"><div class="ttname"><a href="classtpie_1_1serialization__sorter.html">tpie::serialization_sorter</a></div><div class="ttdef"><b>Definition:</b> <a href="serialization__sorter_8h_source.html#l00501">serialization_sorter.h:501</a></div></div>
<div class="ttc" id="aclasstpie_1_1serialization__reverse__writer_html"><div class="ttname"><a href="classtpie_1_1serialization__reverse__writer.html">tpie::serialization_reverse_writer</a></div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00157">serialization_stream.h:157</a></div></div>
<div class="ttc" id="aclasstpie_1_1bits_1_1serialization__reader__base_html_ac2dfee4e06718e689676a2aec212e805"><div class="ttname"><a href="classtpie_1_1bits_1_1serialization__reader__base.html#ac2dfee4e06718e689676a2aec212e805">tpie::bits::serialization_reader_base::unserialize</a></div><div class="ttdeci">void unserialize(T &amp;v)</div><div class="ttdoc">Unserialize an unserializable item from the stream.</div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00321">serialization_stream.h:321</a></div></div>
<div class="ttc" id="aclasstpie_1_1serialization__reverse__reader_html"><div class="ttname"><a href="classtpie_1_1serialization__reverse__reader.html">tpie::serialization_reverse_reader</a></div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00385">serialization_stream.h:385</a></div></div>
<div class="ttc" id="anamespacetpie_html_a2b7b302283490bf2707b94339cd38864"><div class="ttname"><a href="namespacetpie.html#a2b7b302283490bf2707b94339cd38864">tpie::unserialize</a></div><div class="ttdeci">void unserialize(S &amp;src, foo &amp;v)</div><div class="ttdoc">Sample tpie::unserialize prototype.</div></div>
<div class="ttc" id="anamespacetpie_html_aac44cd1e2fb7cbbf4ed5a353cb0cdb3b"><div class="ttname"><a href="namespacetpie.html#aac44cd1e2fb7cbbf4ed5a353cb0cdb3b">tpie::serialize</a></div><div class="ttdeci">void serialize(D &amp;dst, const foo &amp;v)</div><div class="ttdoc">Sample tpie::serialize prototype.</div></div>
<div class="ttc" id="aclasstpie_1_1serialization__writer_html_a5d75d252db09d6ab5495e823441456ab"><div class="ttname"><a href="classtpie_1_1serialization__writer.html#a5d75d252db09d6ab5495e823441456ab">tpie::serialization_writer::serialize</a></div><div class="ttdeci">void serialize(const T &amp;v)</div><div class="ttdoc">Serialize a serializable item and write it to the stream.</div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00136">serialization_stream.h:136</a></div></div>
<div class="ttc" id="aclasstpie_1_1serialization__reverse__writer_html_ad113f5a6fc42c2e3246b15c3b4af88a9"><div class="ttname"><a href="classtpie_1_1serialization__reverse__writer.html#ad113f5a6fc42c2e3246b15c3b4af88a9">tpie::serialization_reverse_writer::serialize</a></div><div class="ttdeci">void serialize(const T &amp;v)</div><div class="ttdoc">Serialize a serializable item and write it to the stream.</div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00230">serialization_stream.h:230</a></div></div>
<div class="ttc" id="aclasstpie_1_1serialization__reader_html"><div class="ttname"><a href="classtpie_1_1serialization__reader.html">tpie::serialization_reader</a></div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00358">serialization_stream.h:358</a></div></div>
<div class="ttc" id="aclasstpie_1_1temp__file_html"><div class="ttname"><a href="classtpie_1_1temp__file.html">tpie::temp_file</a></div><div class="ttdoc">Class representing a reference to a temporary file.</div><div class="ttdef"><b>Definition:</b> <a href="tempname_8h_source.html#l00201">tempname.h:201</a></div></div>
<div class="ttc" id="aclasstpie_1_1serialization__writer_html"><div class="ttname"><a href="classtpie_1_1serialization__writer.html">tpie::serialization_writer</a></div><div class="ttdef"><b>Definition:</b> <a href="serialization__stream_8h_source.html#l00084">serialization_stream.h:84</a></div></div>
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
      <li class="footer">from TPIE 4739728 (<a href="//github.com/thomasmoelhave/tpie/tree/4739728">browse source</a>). Generated on Mon May 23 2022 23:38:36 by
<a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.17 </li>
    </ul>
  </div>
</body>
</html>
