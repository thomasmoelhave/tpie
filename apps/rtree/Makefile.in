# $Id: Makefile.in,v 1.1 2003-11-21 17:26:02 tavi Exp $
#
# Use gmake on this Makefile.  It relies on the default rules.
# Use gmake -p to see the default rules.

CXX = @CXX@
CC = @CC@
TPIEDIR = ../..
TPIEINC = ../../include
TPIELIBDIR = ../../lib
TPIELIB = $(TPIELIBDIR)/libtpie.a
MESADIR = /usr/pkg/Mesa

MINUSG = 0
MINUSPG = 0

LIBPATH = -L$(TPIEDIR)/lib
LINKLIBS = -ltpie -lm
INCLUDEPATH  = -I$(MESADIR)/include/ -I$(TPIEDIR)/include/

LDLIBS = $(LIBPATH) $(LINKLIBS)
MAKEDEPEND = g++ -M

override CPPFLAGS += $(INCLUDEPATH)

ifeq ($(MINUSG),1)
override CPPFLAGS += -g
else
override CPPFLAGS += -O3  #  -DNDEBUG
endif

ifeq ($(MINUSPG),1)
override CPPFLAGS += -pg 
endif

# The various test applications.
APPS = testrtree build_rtree ascii2stream mbr

# Sources to the test applications.
APPSRC = $(patsubst %,%.cpp,$(APPS))

# Other C++ sources for common support routines.
COMMONCXXSRC = hilbert.cpp

CXXSRC = $(APPSRC) $(COMMONCXXSRC)

# Common objects that go into most apps.
COMMONOBJ = $(COMMONCXXSRC:.cpp=.o)

# Translation rules:
%:%.o
	$(LINK.cc) $^ $(LDLIBS) -o $@

# Public targets.

all: $(APPS)

# What objects each of the apps acually need.
testrtree: testrtree.o
build_rtree: build_rtree.o hilbert.o
ascii2stream: ascii2stream.o
mbr: mbr.o

depend: cleandepend
	$(MAKEDEPEND) $(CPPFLAGS) $(CXXSRC) >> Makefile.depend

clean: cleandepend
	-rm -f $(CSRC:.c=.o) $(CXXSRC:.cpp=.o) $(APPS)

distclean: clean
	-rm -f *~ *.bak

backup:
	(set dn = `basename $$cwd `; cd ..; \
	tar cvf $$dn.tar $$dn/*.[CHch] $$dn/Makefile; gzip -f $$dn.tar)

# Private targets.

include Makefile.depend

cleandepend:
	-rm -f Makefile.depend

Makefile.depend:
	rm -f Makefile.depend; \
	$(MAKEDEPEND) $(CPPFLAGS) $(CXXSRC) >> Makefile.depend

.PHONY: clean depend cleandepend backup distclean all
